#
# This makefile uses BSD macro files.  You can get a rudimentary
# set of BSD macro files on POSIX-compliant platforms like Linux and
# Mac OS X by installing a Pkgsrc bootstrap kit from pkgsrc.org.
#
.-include "../mkbin.mk"

FILESDIR=$(DATADIR)/examples/rv-predict-c/c11
INCSDIR=$(FILESDIR)
INCS=lpcq.h nbcompat.h signals.h spcq.h
FILES=Makefile
FILES+=README.lpcq README.raceless-signal
FILES+=$(SRCS.dot-product) $(SRCS.double-checked-locking)
FILES+=$(SRCS.nic)
FILES+=$(SRCS.spinning-loop) $(SRCS.square-sum) $(SRCS.memcpy)
FILES+=$(SRCS.simple-state-machine)
FILES+=$(SRCS.simplerace) $(SRCS.lpcq) $(SRCS.spcq) $(SRCS.raceless-signal)
FILES+=$(SRCS.slpcq)
FILESMODE=0644

.if $(MKBIN:Uno) == "yes"
PROGS=	dot-product double-checked-locking lpcq memcpy raceless-signal
PROGS+=nic
PROGS+=	simple-state-machine simplerace slpcq spcq spinning-loop square-sum
#PROGS+=	stolz-queue
.endif

CC=clang
CFLAGS+=-std=c11
CPPFLAGS+=-D_POSIX_C_SOURCE=199506L
#CPPFLAGS+=-Dlpcq_atomic=_Atomic
#CPPFLAGS.spcq+=-D__STDC_NO_ATOMICS__
WARNS=4

SRCS.dot-product=dot-product.c
SRCS.double-checked-locking=double-checked-locking.c
SRCS.nic=nic.c
SRCS.spinning-loop=spinning-loop.c
SRCS.square-sum=square-sum.c
SRCS.simple-state-machine=simple-state-machine.c
SRCS.memcpy=memcpy.c
SRCS.simplerace=simplerace.c
SRCS.lpcq=lpcq.c lpcq_main.c signals.c
SRCS.slpcq=slpcq.c slpcq_main.c signals.c
SRCS.spcq=spcq.c spcq_main.c
SRCS.raceless-signal=raceless-signal.c signals.c
SRCS.stolz-queue=stolz-queue.c

.include "../rvp.mk"
.include <mkc.prog.mk>
